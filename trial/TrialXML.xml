<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Talent Sprint" height="1000">
    <Require feature="rpc"/>
    <Require feature="views"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
      <script src="//talkgadget.google.com/hangouts/_/api/hangout.js?v=1.1"></script>
  
  <img src="https://github.com/tanujp/GadgetXML/raw/master/talent_sprint.gif"/>	 
  <h3>Welcome to TalentSprint</h3>	
  <p id="participantsDiv">No Trainees joined</p> 
  <p id="No">Number</p>

<script>	

var NoOfParticipants=0;
var participantsId = new Array();
function showParticipants() {
 
  var participants = gapi.hangout.getParticipants();
  var retVal = '<h4>Trainees: </h4><ul>';
  var TrainerId = participants[0].id;
  
  for(var i=1;i<participants.length;i++){
    ++NoOfParticipants;
    var j=0;
    var participant = participants[i];
    var participantsId[j] = participant.id;
    
    if (!participant.person) {
      retVal += '<li>A participant not running this app</li>';
    }
    
    retVal += '<li>' + participant.person.displayName + '</li>';
    j++;
    }

  retVal += '</ul>';

  var div = document.getElementById('participantsDiv');

  div.innerHTML = retVal;
  showVideoFeed();
  
}

var buff;
function showVideoFeed(){
  var canvas = gapi.hangout.getVideoCanvas();
  while(buff<participantsId)
  { 
    var feed = gapi.hangout.layout.createParticipantVideoFeed(participantId[i]);
    canvas.setVideoFeed(feed);
    canvas.setVisible(true);
    buff++;
    setTimeout(showVideoFeed(),5000);
  }
  

}


 // When Gadget is ready...
  function init() {
  console.log('init');
  
  //When API is Ready
  gapi.hangout.onApiReady.add(
      function(eventObj) {
        if (eventObj.isApiReady) {
            console.log('API is Ready');
            showParticipants();
            var current_participant_id=gapi.hangout.getParticipantId();
            alert(current_participant_id);
           
  //When People leave a Hangout
  gapi.hangout.onParticipantsChanged.add(
      function(eventObj){
      console.log('Participants Changed');
      showParticipants();
      });
    }  
      });
  }

  // Wait for gadget to load.                                                       
  gadgets.util.registerOnLoadHandler(init);

</script>   	
    ]]>
  </Content>
</Module>