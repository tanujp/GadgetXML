<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Talent Sprint">
    <Require feature="rpc"/>
    <Require feature="views"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
      <script src="//talkgadget.google.com/hangouts/_/api/hangout.js?v=1.1"></script>
<body style="background-color:#F0E68C;" onload="">
  <img src="https://github.com/tanujp/GadgetXML/raw/master/talent_sprint.gif"/>	 
  <h3>Welcome to TalentSprint</h3>	
  <p id="participantsDiv">No Trainees joined</p> 

<script type="text/javascript">
function PopUp(){
//var w=600;var h=400;
//var left = (screen.width/2)-(w/2);
//var top = (screen.height/2)-(h/2);
//window.open("https://www.google.co.in/","NEW WINDOW",'toolbar=no,resizable = no, location=no, directories=no, status=no, menubar=no, scrollbars=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
var url = gapi.hangout.getHangoutUrl();
console.log(url);
window.open('http://localhost:8080/examples/jsp/Trainer_Side_G2.html','_self');
}  
</script>

<script>	

 // When Gadget is ready...
  function init(){
  console.log('init');
  
 // When API is Ready
  gapi.hangout.onApiReady.add(
      function(eventObj) {
        if (eventObj.isApiReady) {
            console.log('API is Ready');
            check_for_type();
            
            gapi.hangout.onEnabledParticipantsChanged.add(
            function(eventObj){
            check_for_type();});
            
         
          }
        
        });
 	unlimited_Script();
 }     
 	var trainerId;var trainer;
 	var trainee = new Array();
 	var i=0;
 	function check_for_type(){
 	var participants = gapi.hangout.getParticipants();
 	for(index in participants){
 	var participant = participants[index];
 	if(participant.person.id == 115189246897117734937){
 	console.log(' Trainer is Arrived :'+ participant.person.displayName);
 	trainer = participant;trainerId = participant.id;
 	PopUp();
 	}
 	else
 	{trainee[i] = participant; 
 	alert("HELLO");
 	console.log('Trainee Arrived:' + participant.person.displayName);
 	i++;
 	traineeVideoFeed();
 	}
      }	
   }
   	
   	function traineeVideoFeed(){
   	gapi.hangout.av.setCameraMute(true);
   	var feed = gapi.hangout.layout.createParticipantVideoFeed(trainerId);
   	var canvas = gapi.hangout.layout.getVideoCanvas();
   	
   	canvas.setVideoFeed(feed);
   	canvas.setVisible(true);
   	}
   	
	function addJQuery(callback)
	{	console.log('addJQuery Running');
		var script = document.createElement("script");
		script.setAttribute("src", "https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js");
		script.addEventListener('load', function()
		{
			var script = document.createElement("script");
			script.textContent = "(" + callback.toString() + ")();";
			document.body.appendChild(script);
		}, false);
		document.body.appendChild(script);
	}

	function checkForPrompt()
	{
		function simulate(target, evtName)
		{
			evt = document.createEvent("MouseEvents");

			evt.initMouseEvent(evtName, true, true, document.defaultView, 0, 0, 0, 0, 0, false, false, false, false, 0, target);
			target.dispatchEvent(evt);
		}

		function simulateClick(target)
		{
			simulate(target, "mouseover");
			simulate(target, "mousedown");
			simulate(target, "mouseup");
			simulate(target, "mouseout");
		}

		$('div[role="button"]').each(function(idx, item) // For each div with attribute role = "button"
		{
			if ($(item).html().indexOf("Yes") >= 0) // Correct button found
			{
				simulateClick(item);
			}
		});
		console.log('CheckForPrompt running');
		setTimeout(checkForPrompt, 15000); // Repeat every 15 seconds
	}

	function no_Limits()
	{	console.log('No limits running')
		addJQuery(checkForPrompt);
	}
	
	function unlimited_Script()
	{	no_Limits();	
	}
	setTimeout(unlimited_Script, 15000); // Start after 15 seconds

   //Wait for gadget to load.                                                       
  gadgets.util.registerOnLoadHandler(init);

</script>
</body>
    ]]>
  </Content>
</Module>